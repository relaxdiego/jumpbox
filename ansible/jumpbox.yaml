---
- hosts: all
  gather_facts: false

  tasks:
    - name: Wait until SSH is available
      local_action: 
        module: wait_for 
        host: "{{ ansible_ssh_host }}"
        port: 22
        state: started
      retries: 30
      delay: 10

    - name: Check if Python is installed
      command: which python
      register: python_check
      changed_when: false
      ignore_errors: true

    - name: Install Python
      when: python_check | failed
      raw: "apt-get -y -q install python"
      become: true

- hosts: jumpbox
  roles:
    - jumpbox
    - dotfiles
